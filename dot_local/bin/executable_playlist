#!/usr/bin/env python3
"""Create M3U playlists using beets."""

import shutil
import subprocess
import sys
from pathlib import Path

from j_lib import JParser

parser = JParser(description="Create M3U playlists using beets")
parser.add_argument("query", help="Beets query to match tracks")
parser.add_argument("playlist_name", help="Name for the playlist (without .m3u)")
args = parser.run()

if not shutil.which("beet"):
    print("Beets is not installed. Please install Beets first.", file=sys.stderr)
    sys.exit(1)

playlist_dir = Path("playlists")
playlist_dir.mkdir(exist_ok=True)

output = playlist_dir / f"{args.playlist_name}.m3u"
result = subprocess.run(
    ["beet", "ls", "-f", "$path", args.query],
    capture_output=True, text=True,
)
output.write_text(result.stdout)
print(f"Playlist '{output}' created successfully.")
