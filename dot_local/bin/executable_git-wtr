#!/usr/bin/env python3
"""Remove a git worktree using fzf for selection."""

import subprocess
import sys

from j_lib import JParser

parser = JParser(description="Remove git worktree via fzf picker")
parser.run()

# List worktrees, skip bare repo (first line)
result = subprocess.run(
    ["git", "worktree", "list"], capture_output=True, text=True,
)
lines = [
    line for line in result.stdout.strip().splitlines()[1:]
    if "(bare)" not in line
]

if not lines:
    print("No worktrees to remove")
    sys.exit(0)

# Pick with fzf
fzf = subprocess.run(
    ["fzf", "--prompt=Remove worktree: "],
    input="\n".join(lines), capture_output=True, text=True,
)
if fzf.returncode != 0 or not fzf.stdout.strip():
    sys.exit(0)

path = fzf.stdout.strip().split()[0]
subprocess.run(["git", "worktree", "remove", path])
