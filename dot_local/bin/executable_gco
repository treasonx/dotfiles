#!/usr/bin/env python3
"""Git checkout file with fuzzy matching (for conflict resolution).

Usage: gco --ours <partial-filename>
       gco --theirs <partial-filename>
"""

import shutil
import subprocess
import sys


def find_files(pattern: str) -> str:
    if shutil.which("fd"):
        cmd = ["fd", "--type", "f", pattern]
    elif shutil.which("fdfind"):
        cmd = ["fdfind", "--type", "f", pattern]
    else:
        cmd = ["find", ".", "-type", "f", "-name", f"*{pattern}*"]
    return subprocess.run(cmd, capture_output=True, text=True).stdout


def main():
    if len(sys.argv) < 3 or sys.argv[1] not in ("--ours", "--theirs"):
        print("Usage: gco --ours|--theirs <partial-filename>", file=sys.stderr)
        sys.exit(1)

    strategy = sys.argv[1]
    pattern = sys.argv[2]

    files = find_files(pattern)
    if not files.strip():
        return

    result = subprocess.run(
        ["fzf", "--select-1", "--exit-0"],
        input=files, capture_output=True, text=True,
    )
    selected = result.stdout.strip()
    if selected:
        subprocess.run(["git", "checkout", strategy, selected])
        print(f"Checked out ({strategy}): {selected}")


if __name__ == "__main__":
    main()
